<!DOCTYPE html>
<html lang="en" style="overflow-x: hidden;">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Site Metas -->
    <title>PIMA Guitars</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Site Icons -->
    <link rel="shortcut icon" href="images/toplogo.png" type="image/x-icon">
    <link rel="apple-touch-icon" href="images/toplogo.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Site CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="css/responsive.css">
    <!-- Custom CSS -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

</head>



<body class="goto-here">
    <!-- Start Main Top -->
    <div class="main-top">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <div class="text-slid-box">
                        <div id="offer-box" class="carouselTicker">
                            <ul class="offer-box">
                                <li>
                                    <i class="fab fa-opencart"></i> Quality Guitars
                                </li>
                                <li>
                                    <i class="fab fa-opencart"></i> Buy Now!
                                </li>
                                <li>
                                    <i class="fab fa-opencart"></i> Get Yours!
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <div class="right-phone-box">
                        <p>Call US :- <a href="#"> +11 900 800 100</a></p>
                    </div>
                    <div class="our-link">
                        <ul>
                            <li><a href="#"></a></li>
                            <li><a href="https://maps.app.goo.gl/JNCpoGoBVDv7q4SB6" target="_blank">Our location</a></li>
                           
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Start Main Top -->
    <header class="main-header">
        <!-- Start Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-default bootsnav">
            <div class="container">
                <!-- Start Header Navigation -->
                <div class="navbar-header">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbars-rs-food" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa fa-bars"></i>
                </button>
                    <a class="navbar-brand" href="index.html"><img src="images/logo.png" class="logo" alt=""></a>
                </div>
                <!-- End Header Navigation -->

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="navbar-menu">
                    <ul class="nav navbar-nav ml-auto" data-in="fadeInDown" data-out="fadeOutUp">
                        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
                        <li class="dropdown megamenu-fw">
                        <li class="nav-item active"><a class="nav-link" href="products2.html">Shop Products</a></li>
                        <li class="dropdown">

                            <ul class="dropdown-menu">
                                <li><a href="products2.html">Cart</a></li>
                               
                                <li><a href="my-account.html"></a></li>
                               
                            </ul>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" href="contact-us.html">Contact Us</a></li>
                        <li> <a href="products2.html" class="fa fa-shopping-bag"></class=></a> </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->

                
                </div>
                <!-- End Atribute Navigation -->
            </div>
            <!-- Start Side Menu -->
            <div class="side">
                <a href="#" class="close-side"><i class="fa fa-times"></i></a>
                <li class="cart-box">
                    <ul class="cart-list" id="dynamic-cart">
                        <!-- Dynamic cart items will be added here -->
                    </ul>
                </li>
            </div>
            <!-- End Side Menu -->
        </nav>
        <!-- End Navigation -->
    </header>
    <!-- End Main Top -->
    

            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav ml-auto">
                    
                    <li class="nav-item cta cta-colored"><a class="nav-link" data-bs-toggle="offcanvas"
                            href="#offcanvasExample" role="button" aria-controls="offcanvasExample"><span
                                class="icon-shopping_cart">Cart</span><span id="cart_count"></span></a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="dropdown04" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false"><span class="icon-user"></span></a>
                        <div class="dropdown-menu" aria-labelledby="dropdown04" id="userDropdown">
                        </div>
                    </li>
                    <li class="nav-item"><a href="contact.html" class="nav-link" id="greet"></a></li>

                </ul>
            </div>
      
    
    <!-- END nav -->


<!-- Start All Title Box -->
<div class="all-title-box">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2>Cart</h2>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Shop</a></li>
                    <li class="breadcrumb-item active">Cart</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End All Title Box -->
    
        <!-- <a class="btn btn-primary" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample">
			Link with href
		  </a> -->
        <!-- <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
			Button with data-bs-target
		  </button> -->

          <div class="container">
            <div class="row justify-content-center">
                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
                    <div class="offcanvas-header">

                       
                    </div>
                    <div class="offcanvas-body">
                        <form action="" id="form_cart">
                            <div id="cart_container">
                                <!-- Cart items will be dynamically added here -->
                            </div>
                            <div class="checkout-container">
                                <div class="checkout">
                                    <div class="row">
                                        <div class="col">
                                            <span>Total</span>
                                            <div id="totalPrice"></div>
                                        </div>
                                        <div class="col text-right">
                                            <!-- Use the "text-right" class to align the content to the right(right) -->
                                            <div class="btn btn-success" id="checkout_btn">Checkout</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel"
            tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalToggleLabel">Modal 1</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="">

                        </div>
                        <form>
                            <div class="row">
                                <div class="col">
                                    <div class="mb-3">

                                        <label for="recipient-name" class="col-form-label">Recipient:</label>
                                        <input type="text" class="form-control" id="recipient-name">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="message-text" class="col-form-label">Message:</label>
                                        <textarea class="form-control" id="message-text"></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" data-bs-target="#exampleModalToggle2"
                            data-bs-toggle="modal">Open second
                            modal</button>
                    </div>
                </div>
            </div>
        </div>
       
            <!-- Start Products  -->
            <div class="products-box">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="title-all text-center">
                                <h1>Featured Products</h1>
                                <p>Here's the list of available items as of now, please take your time in choosing your
                                    desired
                                    item.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="products-container">
                        <div class="row special-list" id="prodList">
                            
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div class="row" id="prodList">
                <div class="col-md-6 col-lg-3 ftco-animate">
                    <div class="product">
                        <a href="shop.html" class="img-prod"><img class="img-fluid" src="" id="prod1_img"
                                alt="Colorlib Template">
                            <span class="status">30%</span>
                            <div class="overlay"></div>
                        </a>
                        <div class="text py-3 pb-4 px-3 text-center">
                            <h3><a href="#" id="prod1_name"></a></h3>
                            <div class="d-flex">
                                <div class="pricing">
                                    <p class="price"><span class=" mr-2 price-dc">$120.00</span><span>$</span><span
                                            id="prod1_price"></span></p>
                                </div>
                            </div>
                            <div class="bottom-area d-flex px-3">
                                <div class="m-auto d-flex">
                                    <a href="#"
                                        class="add-to-cart d-flex justify-content-center align-items-center text-center">
                                        <span><i class="ion-ios-menu"></i></span>
                                    </a>
                                    <a data-bs-toggle="offcanvas" href="" role="button" aria-controls="offcanvasExample"
                                        class="add-to-cart d-flex justify-content-center align-items-center text-center mx-1"
                                        id="prod1_add_cart">
                                        <span><i class="ion-ios-cart"></i></span>
                                    </a>
                                    <a href="#" class="heart d-flex justify-content-center align-items-center ">
                                        <span><i class="ion-ios-heart"></i></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-5">
                    <div class="col text-center">
                        <div class="block-27">
                            <ul>
                                <li><a href="#">&lt;</a></li>
                                <li class="active"><span>1</span></li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#">4</a></li>
                                <li><a href="#">5</a></li>
                                <li><a href="#">&gt;</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div> -->


  
   

    <!-- Start Footer  -->
    <footer>
        <div class="footer-main">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-12 col-sm-12">
                        <div class="footer-widget">
                            <h4>About PIMA Guitars</h4>
                            <p>PIMA offers a wide variety of musical instruments mainly Guitars from which you can choose from. Our products are top-quality and you can rest assured that it will last and will give you the musical experience you desire. PIMA focuses on giving quality service/repairs and quality products.
                                </p>
                            <ul>
                                <li><a href="https://www.facebook.com/PIMAGuitars" target="_blank"><i class="fab fa-facebook" aria-hidden="true"></i></a></li>
                                <li><a href="https://www.tiktok.com/@pimaguitarslegazpi" target="_blank"><i class="fab fa-tiktok"  aria-hidden="true" ></i></a></li>
                                <li><a href="https://www.instagram.com/pimaguitarslegazpi/" target="_blank"><i class="fab fa-instagram" aria-hidden="true"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-12 col-sm-12">
                        <div class="footer-link">
                            <h4>Information</h4>
                            <ul>
                                <li><a href="about.html">About Us</a></li>
                                <li><a href="contact-us.html">Customer Service</a></li>
                                <li><a href="https://www.facebook.com/PIMAGuitars/photos_by" target="_blank">Our Gallery</a></li>
                                                             
                                
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-12 col-sm-12">
                        <div class="footer-link-contact">
                            <h4>Contact Us</h4>
                            <ul>
                                <li>
                                    <p><i class="fas fa-map-marker-alt"></i>Address: Purok 6 Malangka<br> Legazpi, City</p>
                                </li>
                                <li>
                                    <p><i class="fas fa-phone-square"></i>Phone: <a href="tel:+63 197 003 195">+63 197 003 195</a></p>
                                </li>
                                <li>
                                    <p><i class="fas fa-envelope"></i>Email: <a href="mailto:pimamusic01@gmail.com">pimamusic01@gmail.com</a></p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- End Footer  -->
    <!-- Greetings!!  -->
    <!-- Kulangunun pa sa time !-->
    <!-- Start copyright  -->
    <div class="footer-copyright">
        <p class="footer-company">All Rights Reserved. &copy; 2020 <a href="#">PIMA Guitars</a></p>
    </div>
    <!-- End copyright  -->

    <a href="#" id="back-to-top" title="Back to top" style="display: none;">&uarr;</a>

    <!-- ALL JS FILES -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- ALL PLUGINS -->
    <script src="js/jquery.superslides.min.js"></script>
    <script src="js/bootstrap-select.js"></script>
    <script src="js/inewsticker.js"></script>
    <script src="js/bootsnav.js."></script>
    <script src="js/images-loded.min.js"></script>
    <script src="js/isotope.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/baguetteBox.min.js"></script>
    <script src="js/form-validator.min.js"></script>
    <script src="js/contact-form-script.js"></script>
    <script src="js/custom.js"></script>
</body>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
        import { getStorage } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-storage.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
        import { Stripe } from "https://cdn.skypack.dev/stripe";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdJ18MNp1wBnGP5YM3penvsjqp8o5wvkM",
            authDomain: "auth-ddcad.firebaseapp.com",
            databaseURL: "https://auth-ddcad-default-rtdb.firebaseio.com",
            projectId: "auth-ddcad",
            storageBucket: "auth-ddcad.appspot.com",
            messagingSenderId: "632550091518",
            appId: "1:632550091518:web:1afe4024d4a13a882653af"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const storage = getStorage(app);
        const productsRef = ref(db, 'Products');
        const auth = getAuth();
        const stripe = new Stripe('pk_test_51ONeFdCH9Yb9ZLbwyfdqmjQ7sw2NxtL6BtwSzT3b95IZS8W8A9QMhXlK3BpMj99a8oSMrRaWMKap9bg8DeA8aDAj00gxdZjLSS');

        let userCredentials = JSON.parse(sessionStorage.getItem("user-credentials"));
        let userInfo = JSON.parse(sessionStorage.getItem("user-info"));

        let greet = document.getElementById("greet");
        let signOutButton = document.getElementById("sign_out");

        let signOut = () => {
            sessionStorage.removeItem("user-info");
            sessionStorage.removeItem("user-credentials");
            window.location.href = "logs.html";
        };

        let userDropdown = document.getElementById("userDropdown");

        let updateDropdownMenu = () => {
            if (userCredentials) {
                userDropdown.innerHTML = `
							<a class="dropdown-item" href="#" id="sign_out">Sign Out</a>`;
                greet.innerHTML = `Welcome ${userInfo.username}!`;
            } else {
                userDropdown.innerHTML = `
							<a class="dropdown-item" href="signup.html" id="sign_up">Sign Up</a>
							<a class="dropdown-item" href="logs.html" id="log_in">Log In</a>`;
            }
        };

        let checkCred = () => {
            updateDropdownMenu();
        };

        window.addEventListener('load', checkCred);
        userDropdown.addEventListener('click', (event) => {
            if (event.target.id === 'sign_out') {
                signOut();
            } else if (event.target.id === 'sign_up') {
                window.location.href = 'signup.html';
            } else if (event.target.id === 'log_in') {
                window.location.href = 'Account_As.html';
            }
        });

        const totalPriceElement = document.getElementById('totalPrice');
        const prodListContainer = document.getElementById('prodList');
        const cartContainer = document.getElementById('cart_container');
        const checkoutButton = document.getElementById('checkout_btn');

        let cartItems = {};
        let totalPrice = 0;




        const updateTotalPrice = () => {
            let totalCartPrice = 0;

            for (const productId in cartItems) {
                if (cartItems[productId] && cartItems[productId].productData) {
                    const productData = cartItems[productId].productData;
                    totalCartPrice += parseFloat(productData.price) * cartItems[productId].quantity;
                }
            }

            totalPrice = totalCartPrice;
            totalPriceElement.innerHTML = `${totalPrice.toFixed(2)}`;
        };

        const updateCartCounter = () => {
            let itemCount = Object.values(cartItems).reduce((total, item) => total + item.quantity, 0);
            itemCount = Math.max(itemCount, 0);
            document.getElementById('cart_count').innerHTML = `[${itemCount}]`;
        };

        const removeFromCart = (productId, cartItemId) => {
            const removedQuantity = cartItems[productId].quantity;
            const removedPrice = parseFloat(cartItems[productId].productData.price) * removedQuantity;
            const userCartRef = ref(db, `UserAuthList/${userCredentials.uid}/cart/${productId}`);

            set(userCartRef, null)
                .then(() => {
                    delete cartItems[productId];
                    localStorage.setItem('cartItems', JSON.stringify(cartItems));
                    const cartItemElement = document.getElementById(cartItemId);
                    cartContainer.removeChild(cartItemElement);
                    totalPrice -= removedPrice;
                    updateTotalPrice();
                    updateCartCounter();
                })
                .catch((error) => {
                    console.error("Error removing item from the database:", error);
                });
        };

        const addToCart = (productId, productData) => {
            const cartItemId = `${productId}_cart_item`;

            if (!userCredentials) {
                alert('Please sign in to add items to your cart.');
                window.location.href = 'logs.html';
                return;
            }

            const userCartRef = ref(db, `UserAuthList/${userCredentials.uid}/cart/${productId}`);

            if (cartItems[productId]) {
                const updatedQuantity = cartItems[productId].quantity + 1;
                set(userCartRef, { productData, quantity: updatedQuantity })
                    .then(() => {
                        cartItems[productId].quantity = updatedQuantity;
                        const quantityInput = document.getElementById(`${cartItemId}_quantity`);
                        if (quantityInput) {
                            quantityInput.value = updatedQuantity;

                            // Check if quantityInput exists before adding the event listener
                            quantityInput.addEventListener('input', () => {
                                const quantity = parseInt(quantityInput.value, 10);
                                cartItems[productId].quantity = quantity;
                                const updatedPrice = quantity * parseFloat(productData.price);
                                document.getElementById(`price_${cartItemId}`).innerHTML = updatedPrice.toFixed(2);
                                updateTotalPrice();
                            });
                        }

                        updateTotalPrice();
                        updateCartCounter();
                    })
                    .catch((error) => {
                        console.error("Error updating quantity in the database:", error);
                    });
            } else {
                set(userCartRef, { productId, productData, quantity: 1 })
                    .then(() => {
                        cartItems[productId] = { productData, quantity: 1 };
                        const cartItem = document.createElement('div');
                        cartItem.classList.add('col', 'addedToCart', 'border', 'border-primary');
                        cartItem.id = cartItemId;
                        cartContainer.appendChild(cartItem);
                        const quantityInput = document.getElementById(`${cartItemId}_quantity`);
                        if (quantityInput) {
                            quantityInput.addEventListener('input', () => {
                                const quantity = parseInt(quantityInput.value, 10);
                                cartItems[productId].quantity = quantity;
                                const updatedPrice = quantity * parseFloat(productData.price);
                                document.getElementById(`price_${cartItemId}`).innerHTML = updatedPrice.toFixed(2);
                                updateTotalPrice();
                            });
                        }

                        const removeButton = cartItem.querySelector('._remove-cart');
                        removeButton.addEventListener('click', () => {
                            removeFromCart(productId, cartItemId);
                        });

                        updateTotalPrice();
                        updateCartCounter();
                    })
                    .catch((error) => {
                        console.error("Error adding item to the database:", error);
                    });
            }
            console.log(productData);
            alert('Item Added to Cart');
        };


        const updateCartUI = () => {
            cartContainer.innerHTML = '';
            let totalCartPrice = 0;

            for (const productId in cartItems) {
                const cartItemId = `${productId}_cart_item`;

                if (cartItems[productId] && cartItems[productId].productData) {
                    const productData = cartItems[productId].productData;

                    const cartItem = document.createElement('div');
                    cartItem.classList.add('col', 'addedToCart', 'border', 'border-secondary-subtle');
                    cartItem.id = cartItemId;
                    cartItem.innerHTML = `
								<div class="row">
									<div class="col" id="cart_prod_img">
										<img src="${productData.image}" alt="" width="100%" height="100%" style="object-fit: contain;">
									</div>
									<div class="col">
										<div class="" id="">${productData.productName}</div>
										<div class="" id="price_${cartItemId}">${parseFloat(productData.price).toFixed(2)}</div>
										<div class="input-group input-group-sm mb-3">
											<span class="input-group-text" id="itemQuantity">Quantity</span>
											<input id='${cartItemId}_quantity' type="number" min='0' value='${cartItems[productId].quantity}' class="form-control"
												aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
											<button type="button" class='_remove-cart rounded btn-danger mt-3' data-product-id='${productId}'>Remove</button>
										</div>
									</div>
								</div>
							`;

                    cartContainer.appendChild(cartItem);

                    totalCartPrice += parseFloat(productData.price) * cartItems[productId].quantity;

                    const quantityInput = document.getElementById(`${cartItemId}_quantity`);
                    quantityInput.addEventListener('input', () => {
                        const quantity = parseInt(quantityInput.value, 10);
                        cartItems[productId].quantity = quantity;
                        updateTotalPrice();
                    });

                    const removeButton = cartItem.querySelector('._remove-cart');
                    removeButton.addEventListener('click', () => {
                        removeFromCart(productId, cartItemId);
                    });
                }
            }

            totalPrice = totalCartPrice;
            updateTotalPrice();
            updateCartCounter();
        };

        const renderProductData = (productId, productData) => {
            const productElement = document.createElement('div');
            productElement.classList.add("col-lg-3", "col-md-6", "special-grid", "bass");
            productElement.innerHTML = `
						
                   
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="${productData.image}" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="shop-detailb4.html" data-toggle="tooltip" data-placement="right"
                                                title="View"><i class="fas fa-eye"></i></a></li>

                                    </ul>
                                    <a class="cart" id="${productId}_add_cart" >Add
                                        to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4 id="${productId}">${productData.productName}</h4>
                                <h5 id="prod_${productId}_price"> ${productData.price}</h5>
                            </div>
                        </div>
                    </div>
               

                        
					`;

            prodListContainer.appendChild(productElement);

            const addToCartButton = document.getElementById(`${productId}_add_cart`);

            addToCartButton.addEventListener('click', () => {
                // Add the necessary information, including the quantity, to the item object
                const item = {
                    title: productData.productName,
                    productImg: productData.image,
                    quantity: 1, // Set the initial quantity here
                };
                addToCart(productId, item);
            });
        };

        const fetchProductData = () => {
            onValue(productsRef, (snapshot) => {
                const products = snapshot.val();
                prodListContainer.innerHTML = '';

                for (const productId in products) {
                    renderProductData(productId, products[productId]);
                }

                if (userCredentials) {
                    const userCartRef = ref(db, `UserAuthList/${userCredentials.uid}/cart`);

                    onValue(userCartRef, (cartSnapshot) => {
                        const userCart = cartSnapshot.val();

                        if (userCart) {
                            cartItems = userCart;
                        }

                        // Ensure that product data is attached to each cart item
                        for (const productId in cartItems) {
                            const product = products[productId];
                            if (product) {
                                cartItems[productId].productData = product;
                            }
                        }

                        updateCartUI();
                    });
                }
            });
        };



        document.addEventListener('DOMContentLoaded', () => {
            fetchProductData();

            cartContainer.addEventListener('click', (event) => {
                const target = event.target;
                if (target.classList.contains('_remove-cart')) {
                    const productId = target.dataset.productId;
                    const cartItemId = `${productId}_cart_item`;
                    removeFromCart(productId, cartItemId);
                }
            });

            checkoutButton.addEventListener('click', async () => {
                // Convert the cart items into an array of line items
                const lineItems = Object.values(cartItems).map(item => ({
                    title: item.productData.productName,
                    price: item.productData.price,
                    quantity: item.quantity,
                    productImg: item.productData.image,
                }));

                try {
                    // Add userId to the request body
                    const requestBody = {
                        items: lineItems,
                        userId: userCredentials.uid, // Assuming userCredentials has the userId
                    };

                    // Send a POST request to the server with the line items and userId in the request body
                    const response = await fetch('/stripe-checkout', {
                        method: 'POST',
                        headers: new Headers({
                            'Content-Type': 'application/json',
                        }),
                        body: JSON.stringify(requestBody),
                    });

                    // Parse the response from the server, which is expected to contain a session URL
                    const sessionUrl = await response.json();

                    // Redirect the user to the Stripe checkout session
                    window.location.href = sessionUrl.url;

                } catch (error) {
                    console.error('Error during checkout:', error);
                }
            });
        });
        // Assuming this script is included after the button element


// Assuming this script is included after the button element


checkoutButton.addEventListener('click', () => {
    // Check if the cart is empty
    if (Object.keys(cartItems).length === 0) {
        alert('There are no items in the cart. Add products to the cart before checking out.');
        return; // Don't proceed to checkout
    }

    // Encode the cart information as a URL parameter
    const cartInfo = encodeURIComponent(JSON.stringify(cartItems));

    // Redirect to checkout.html with the cart information as a parameter
    window.location.href = `checkout.html?cartInfo=${cartInfo}`;
});



        


    </script>



</html>